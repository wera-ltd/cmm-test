import{_ as te}from"./BtdgsVnW.js";import{u as oe,a as se,_ as re}from"./DByeahsE.js";import{_ as ne}from"./-C8tlH1_.js";import{_ as le}from"./CVQbodDu.js";import{T as ae}from"./C7pkw7CK.js";import ce from"./D67S3bux.js";import ie from"./Bn3FmwAy.js";import de from"./ZpQP_QtN.js";import ue from"./mBfcF2d8.js";import me from"./1-pWdXpq.js";import pe from"./Dtn_6bjy.js";import{m as _e,n as he,r as D,p as A,x as fe,g as ye,v as ve,j as xe,c as y,o as d,b as v,a as e,w as g,s as ge,k as t,F as T,L as B,z as S,A as $,l as we,t as _,M as j,y as be,d as L,C as ke,P as N}from"./BREPjQdo.js";import{u as U}from"./mAvCVT-U.js";import"./B0VtVdzK.js";import"./D5VtTd5w.js";import"./BfSQJXoB.js";import"./CMlVg5QU.js";import"./79dB9rum.js";import"./DuN2yyW_.js";import"./BCdQlN8C.js";import"./BJbbxM5p.js";import"./DPeJ-v6s.js";import"./DrtdrCFA.js";import"./DdRnUkt1.js";import"./B6U35Hsm.js";import"./D_OXu7Ei.js";import"./BTQ5rHcE.js";import"./CBqmFlDi.js";import"./DRHJf64T.js";import"./WmMOO-Fx.js";import"./C6LF1M18.js";import"./Bv1Y8TkT.js";import"./KBnWvxCr.js";const Ce=_e(()=>{const{data:w,...b}=he({key:()=>["workHistory","errorList"],query:()=>U().workHistory.historyErrorListGet().then(o=>o.data)}),u=D({keyword:"",channels:[],errorCategory:"All"}),I=A(()=>{var a;const o=[{name:"All",code:"All"},{name:"옵션변경",code:"error-001"},{name:"판매중지",code:"error-002"},{name:"상품조회",code:"error-003"},{name:"채널정책",code:"error-999"}],i=((a=w.value)==null?void 0:a.error_group_code_data)||[];return o.map(r=>{var m;if(r.code==="All")return{...r,count:((m=w.value)==null?void 0:m.error_tot_count)||0};const p=i.find(x=>x.code===r.code);return{...r,count:(p==null?void 0:p.count)||0}})}),h=A(()=>{var i;let o=((i=w.value)==null?void 0:i.error_data_list)||[];if(u.value.errorCategory!=="All"&&(o=o.filter(a=>a.error_type_code===u.value.errorCategory)),u.value.keyword&&u.value.keyword.trim()){const a=u.value.keyword.trim();o=o.filter(r=>{const p=(r.channel_product_name||"").toLowerCase(),m=(r.channel_product_id||"").toLowerCase(),x=(r.error_type_name||"").toLowerCase();return p.includes(a)||m.includes(a)||x.includes(a)})}if(u.value.channels&&u.value.channels.length>0){const a=u.value.channels.map(r=>{const[p]=r.key.split("::");return p});o=o.filter(r=>a.includes(r.channel_id))}return o}),l=D([]),V=A({get:()=>h.value.length?l.value.length===h.value.length:!1,set:o=>{o?l.value=[...h.value]:l.value=[]}}),P=o=>l.value.some(i=>i.mid===o.mid),E=o=>{const i=l.value.findIndex(a=>a.mid===o.mid);i>-1?l.value.splice(i,1):l.value.push(o)};return fe(h,()=>{l.value=[]}),{data:w,errorCategories:I,filteredErrorData:h,filter:u,isAllSelected:V,isItemSelected:P,selectedItems:l,toggleItemSelection:E,...b}}),Se={class:"portrait:h-dvh"},$e={class:"flex items-center gap-1"},Ie={ref:"$elExceptDiv",class:"px-4 js-exception-content"},Ve={class:"flex items-center mb-1 bg-white rounded-2xl"},Pe=["onClick"],Ee={class:"text-sm font-normal"},Ae={key:1,class:"text-sm font-normal"},Le={class:"flex items-center"},He={class:"flex items-center gap-2 text-sm"},De={key:0,class:"font-medium"},Te={class:"js-list"},Be={class:"flex w-full items-center mb-1"},je={class:"w-4"},Ne=["checked","onChange"],Ue={class:"w-14 text-center flex-none"},ze=["src"],Me={class:"gap-1 w-[calc(100%-7rem)] ml-1"},qe={class:"flex items-center justify-between mb-1"},Fe={class:"font-medium leading-4"},Qe={class:"flex items-center"},Re={class:"text-gray-400 text-xxs overflow-ellipsis whitespace-nowrap overflow-hidden"},Oe={type:"button",class:"text-xs w-8 h-8 right-0 top-0 text-[#3f7ddc]"},Ge={class:"flex items-center pl-4"},We={class:"w-14 text-center flex-none text-xs text-gray-400"},Je={class:"w-[calc(100%-4rem)] text-xs ml-1 flex items-center justify-between pr-3"},Ke={class:"text-red-400"},At=ye({__name:"error-list",setup(w){const b=U(),{contentHeight:u,updateAllHeights:I}=oe(".js-exception-content");ve(()=>{I()});const{confirm:h,toast:l}=xe(),{getChannelIcon:V,channelOptionsWithAccount:P}=se(),{data:E,error:o,isLoading:i,refetch:a,errorCategories:r,filteredErrorData:p,filter:m,isAllSelected:x,isItemSelected:z,selectedItems:f,toggleItemSelection:M}=Ce(),q=()=>{if(f.value.length===0){l.error("최소 1개이상의 품목을 선택바랍니다.");return}h({header:"오류 재전송",message:"채널로 오류 상품을 재전송하시겠습니까?",accept:()=>{console.log("확인");const{mutate:k}=N({mutation:()=>b.workHistory.historyErrorSyncPost({HistoryErrorSyncPostRequest:{type:"T",mid:f.value.map(s=>s.mid)}}),onSuccess:()=>{l.success(`총 ${f.value.length}건이 전송되었습니다.`)}});k()}})},F=()=>{if(f.value.length===0){l.error("최소 1개이상의 품목을 선택바랍니다.");return}h({header:"상품 동기화",message:"옵션을 동기화 하시겠습니까?",accept:()=>{console.log("확인");const{mutate:k}=N({mutation:()=>b.workHistory.historyErrorSyncPost({HistoryErrorSyncPostRequest:{type:"S",mid:f.value.map(s=>s.mid)}}),onSuccess:()=>{l.success(`총 ${f.value.length}건이 상품 동기화 진행합니다.`)}});k()}})};return(k,s)=>{const H=ge,Q=te,R=re,O=pe,G=me,W=ue,J=de,K=ne,X=le,Y=ie,Z=ce,ee=ae;return d(),y("article",Se,[v(Q,null,{right:g(()=>[e("div",$e,[v(H,{type:"button",class:"flex items-center gap-2 text-blue-600! bg-white! border-white!",rounded:"",outlined:"",onClick:q},{default:g(()=>s[3]||(s[3]=[e("span",{class:"text-sm"},"오류 재전송",-1)])),_:1,__:[3]}),v(H,{type:"button",class:"flex items-center gap-2 text-blue-600! bg-blue-100! border-blue-100!",rounded:"",onClick:F},{default:g(()=>s[4]||(s[4]=[e("span",{class:"text-sm"},"상품 동기화",-1)])),_:1,__:[4]})])]),_:1}),e("div",Ie,[v(R,{modelValue:t(m).channels,"onUpdate:modelValue":s[0]||(s[0]=n=>t(m).channels=n),options:t(P),placeholder:"판매채널 선택",class:"mb-1!","button-class":"rounded-full!"},null,8,["modelValue","options"]),v(W,{class:"mb-4 w-full"},{default:g(()=>[v(O,{modelValue:t(m).keyword,"onUpdate:modelValue":s[1]||(s[1]=n=>t(m).keyword=n),type:"text",class:"text-sm! w-full rounded-full! peer",placeholder:"상품명, 품목코드, 오류구분을 입력하세요"},null,8,["modelValue"]),v(G,{class:"pi pi-search peer-focus:text-primary!"})]),_:1}),e("div",Ve,[(d(!0),y(T,null,B(t(r),(n,c)=>(d(),y("button",{key:c,class:j(["py-2 w-full text-center text-gray-600",{"rounded-l-2xl w-56!":c===0,"rounded-r-2xl":c===t(r).length-1,"bg-gray-950 text-white":t(m).errorCategory===n.code}]),onClick:C=>t(m).errorCategory=n.code},[n.count?(d(),S(J,{key:0,value:n.count,size:"small",pt:{pcBadge:{root:"font-normal! bg-red-400! outline-1! rounded-full! -top-[5px]! right-[5px]!"}}},{default:g(()=>[e("strong",Ee,_(n.name),1)]),_:2},1032,["value"])):(d(),y("strong",Ae,_(n.name),1))],10,Pe))),128))])],512),e("div",{class:"px-4 pt-2 overflow-auto scrollbar-none transition-all duration-300",style:ke({height:t(u)})},[t(i)?(d(),S(K,{key:0,class:"h-full"})):$("",!0),t(o)?(d(),S(X,{key:1,retry:t(a)},null,8,["retry"])):$("",!0),e("div",Le,[e("div",He,[v(Y,{modelValue:t(x),"onUpdate:modelValue":s[2]||(s[2]=n=>we(x)?x.value=n:null),size:"small","input-id":"all",name:"all",binary:!0},null,8,["modelValue"]),s[5]||(s[5]=e("label",{for:"all"},"전체선택",-1)),t(f).length>0?(d(),y("p",De,_(t(f).length)+"개 선택 ",1)):$("",!0)])]),!t(i)&&!t(o)&&t(E)?(d(),S(Z,{key:2,value:t(p),class:"w-full h-full",pt:{content:"bg-inherit! h-full"}},{list:g(n=>[e("div",Te,[(d(!0),y(T,null,B(n.items,(c,C)=>(d(),y("div",{key:C},[e("div",{class:j(["w-full py-2 text-sm border-gray-300 dark:border-gray-700",{"border-t":C!==0,"border-b":C===n.items.length-1}])},[e("div",Be,[e("div",je,[e("input",{type:"checkbox",checked:t(z)(c),onChange:Xe=>t(M)(c)},null,40,Ne)]),e("div",Ue,[e("img",{src:t(V)(c.channel_id),alt:"",class:"w-10 h-10 mx-auto"},null,8,ze)]),e("div",Me,[e("div",qe,[e("p",Fe,_(c.channel_product_name),1)]),e("div",Qe,[e("div",Re,[L(_(c.channel_name)+" ",1),s[6]||(s[6]=e("span",{class:"bg-gray-300 mx-1 w-px h-2 inline-block"},null,-1)),L(" "+_(c.channel_product_id),1)])])]),be((d(),y("button",Oe,s[7]||(s[7]=[e("i",{class:"pi pi-chevron-down text-gray-400! text-sm!"},null,-1)]))),[[ee,{value:c.msg,pt:{text:"text-sm!"}},void 0,{focus:!0,bottom:!0}]])]),e("div",Ge,[e("div",We,_(c.worker_name),1),e("div",Je,[e("span",Ke,_(c.error_type_name),1),L(" "+_(c.created_at),1)])])],2)]))),128))])]),_:1},8,["value"])):$("",!0)],4)])}}});export{At as default};
